# UI Polish Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Polish the Streamlit UI to be simple, friendly, and delightful — fix stale copy, disable button when no file, improve spinner text, and add in-app picture preview.

**Architecture:** All changes in `streamlit_app.py` only. After conversion, iterate `doc.pictures` to render each picture's image and description in expanders. Uses `pic.get_image(doc)` (PIL Image) and the existing `_get_description()` helper from `pipeline/output.py` (re-exported via `pipeline`).

**Tech Stack:** Streamlit, docling (`DoclingDocument`, `PictureItem`)

---

### Task 1: Fix subtitle, button state, and spinner text

**Files:**
- Modify: `streamlit_app.py:13-24`

**Step 1: Update subtitle, button, and spinner**

Replace lines 13-24 of `streamlit_app.py` with:

```python
st.title("Picture Description Pipeline")
st.write("Describe pictures in PDF documents using a local vision model.")

uploaded_file = st.file_uploader("Upload file", type=["pdf"])

if st.button("Annotate", type="primary", disabled=not uploaded_file):
    tmp_path: str | None = None
    try:
        with st.spinner("Describing pictures... This may take a few minutes for large documents."):
```

This removes the `if uploaded_file is None` / `st.warning` branch entirely — the disabled button makes it unnecessary. The indentation of everything inside the `if st.button` block loses one level of nesting.

**Step 2: Remove the old warning branch**

Delete lines 19-20 from the original (the `if uploaded_file is None:` / `st.warning("Upload a PDF file.")` / `else:` block). The `try:` block now sits directly inside `if st.button(...):`  — no `else:` wrapper.

**Step 3: Run the app and verify**

Run: `uv run streamlit run streamlit_app.py`

Verify:
- Subtitle says "Describe pictures in PDF documents using a local vision model."
- "Annotate" button is greyed out with no file uploaded
- Upload a PDF — button becomes clickable
- Click "Annotate" — spinner says "Describing pictures... This may take a few minutes for large documents."

**Step 4: Commit**

```bash
git add streamlit_app.py
git commit -m "fix: update subtitle, disable button without file, improve spinner text"
```

---

### Task 2: Add in-app picture preview with expanders

**Files:**
- Modify: `streamlit_app.py` (after the download button, ~line 46)

**Step 1: Add the pictures preview section**

After the `st.download_button(...)` block (around line 46), add:

```python
            for idx, pic in enumerate(doc.pictures, 1):
                with st.expander(f"Picture {idx}", expanded=idx == 1):
                    col_img, col_desc = st.columns(2)
                    image = pic.get_image(doc)
                    if image:
                        col_img.image(image)
                    caption = pic.caption_text(doc=doc)
                    if caption:
                        col_img.caption(caption)
                    desc = _get_description(pic)
                    if desc:
                        col_desc.markdown(desc["text"])
                    else:
                        col_desc.write("No description available.")
```

This needs `_get_description` imported. Update the import line:

```python
from pipeline import build_output, convert, create_converter
from pipeline.output import _get_description
```

**Step 2: Run the app and verify**

Run: `uv run streamlit run streamlit_app.py`

Upload a PDF with pictures and click "Annotate". Verify:
- Metrics row and download button still appear
- Below them, one expander per picture labeled "Picture 1", "Picture 2", etc.
- First expander is open by default, rest collapsed
- Inside each expander: image on the left, description text on the right
- Captions appear under the image when present

**Step 3: Commit**

```bash
git add streamlit_app.py
git commit -m "feat: add in-app picture preview with expanders"
```
